<Project>
  <PropertyGroup>
    <ILRepackOutputAssembly>$(OutputPath)/$(TargetFramework)/$(AssemblyName).Repacked.dll</ILRepackOutputAssembly>
    <ILRepackExecutable>~/.nuget/packages/jetbrains.build.ilrepack/0.0.1/tools/netcore/ILRepack.dll</ILRepackExecutable>
    <LibDirectory>$(OutputPath)/$(TargetFramework)</LibDirectory>
  </PropertyGroup>
  <PropertyGroup Condition="'$(OS)' == 'Windows_NT'">
    <ILRepackExecutable>&quot;$(UserProfile)/.nuget/packages/jetbrains.build.ilrepack/0.0.1/tools/netcore/ILRepack.dll&quot;</ILRepackExecutable>
  </PropertyGroup>
  <Target Name="RiderILRepack" AfterTargets="Build" Inputs="@(ILRepackInputAssemblies)" Outputs="$(ILRepackOutputAssembly)">
<!--    <Error Condition="!Exists($(ILRepackExecutable))" Text="ILRepack executable not found '$(ILRepackExecutable)'" />-->
    <Exec Command="&quot;$(DOTNET_HOST_PATH)&quot; $(ILRepackExecutable) /parallel /internalize /lib:&quot;$(LibDirectory)&quot; /out:&quot;$(ILRepackOutputAssembly)&quot; @(ILRepackInputAssemblies -> '&quot;%(FullPath)&quot;', ' ')"/>
  </Target>
</Project>
